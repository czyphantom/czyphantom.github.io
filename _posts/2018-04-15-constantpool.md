---
layout:     post
title:      虚拟机常量池
subtitle:   
date:       2018-04-15
author:     CZY
header-img: img/bg.png
catalog: true
tags:
    - JVM
---

# 虚拟机中的各种常量池

之前一直没有很好地区分编译时常量池，字符串常量池和运行时常量池，这次好好总结一下。

## 字符串常量池

字符串常量池是针对字符串对象创建的时候，为了减少内存开销，给字符串对象开辟的一块缓存区（以前以为没有专门的字符串常量池，只有运行时常量池，现在想想可能字符串常量池是运行时常量池的一部分?）。JVM实现字符串常量池使用的是一个Hash表，对池中的每一个字符串字面量都有一个引用指向它，Hash表表长默认为1009,在JDK1.7之前的版本，这个长度不能更改，这导致了一旦字符串数量增多，造成大量hash冲突，拉链变长，性能下降。在JDK1.7及之后的版本则可以通过参数-XX:StringTableSize指定。

在JDK1.6及之前的版本中，字符串常量池存放在永久代中（也即方法区），在JDK1.7及之后的版本中，字符串常量池放在了堆中（主要是因为永久代的内存空间小，容易OutOfMemory。且JDK1.8已经完全消除了永久代）。

字符串常量池里面存放的都是字符串字面量吗?不是，在JDK1.7之前的版本中，确实都存放的字符串字面量，但是自JDK1.7起，由于改进了intern方法，字符串常量池可能也存放对堆上对象的引用，如果调用intern方法在字符串常量池没有找到，不会新建一个字符串，而是在字符串常量池生成一个对堆上对象的引用。

## 编译时常量池（Class常量池）

也就是在Class文件中的Constant Pool，存放编译器生成的各种字面量和符号引用。字面量包含各种基本类型的数值以及字符串字面量。符号引用包括类和方法的全限定名，字段的名称和描述符，方法的名称和描述符。

## 运行时常量池

即把编译时常量池加载到内存中的部分，其中字符串常量池和其他常量在java堆中，符号引用在native堆中。

# 参考文章

[Java中的常量池(字符串常量池、class常量池和运行时常量池)](https://blog.csdn.net/zm13007310400/article/details/77534349)
