---
layout:     post
title:      JVM元空间
subtitle:   
date:       2018-10-20
author:     CZY
header-img: img/bg.png
catalog: true
tags:
    - JVM
---

JDK1.8开始，永久代的概念被废弃了，取而代之的是元空间（Metaspace）。元空间使用的是本地内存，因此默认情况下元空间的大小只受本地内存以及操作系统的限制。

# 永久代历史

在JDK1.7之前的版本中，类的元数据（不是Class对象,Class对象是类加载的最后产物，元数据信息是根据Class文件得到的类的一些信息比如常量池，属性表，方法字节码等）存放在永久代中，永久代是方法区的一个实现。永久代是一堆连续的堆空间，通过参数可以设置大小。永久代的垃圾收集和老年代是捆绑在一起的，因此无论哪个满了，都会触发永久代和老年代的垃圾收集。这样以来会造成一个问题，如果JVM加载的类的信息快速增长，超过了永久代设置的大小，就会出现OutOfMemoryError，永久代的大小一定得有一个指定值，且这个指定值受到堆内存大小的影响，这就造成了很难正确的设置这个值。

JDK1.7开始逐步取消了永久代，首先是将符号引用转移到native堆，常量和静态变量都转移到了java堆。

# 元空间的引入

为了防止夹在的类越多造成OOM，JDK1.8引入了元空间，将类的一些元数据信息转移到了元空间，元空间默认只由本地内存和操作系统限制，但是也可以通过参数来进行限制（不仅仅是限制大小）。

# 参考文章

[Java PermGen 去哪里了?](http://ifeve.com/java-permgen-removed/)
